name: Screenshot & Unique Visitor/Likes System

on:
  push:
    branches: [main, master]
  schedule:
    - cron: '0 */2 * * *' # –ö–æ–∂–Ω—ñ 2 –≥–æ–¥–∏–Ω–∏
  workflow_dispatch:
    inputs:
      add_like:
        description: 'Add your like (only one per user allowed)'
        required: false
        default: false
        type: boolean
      screenshot_selector:
        description: 'CSS selector for screenshot'
        required: false
        default: 'body'
        type: string

env:
  SCREENSHOT_WIDTH: ${{ vars.SCREENSHOT_WIDTH || '1920' }}
  SCREENSHOT_HEIGHT: ${{ vars.SCREENSHOT_HEIGHT || '1080' }}
  BADGE_STYLE: ${{ vars.BADGE_STYLE || 'for-the-badge' }}
  BADGE_COLOR: ${{ vars.BADGE_COLOR || 'brightgreen' }}
  LIKES_COLOR: ${{ vars.LIKES_COLOR || 'red' }}

jobs:
  update-readme-and-visitor:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          persist-credentials: true
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install system dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y google-chrome-stable

      - name: Install Node.js dependencies
        run: |
          if [ -f "package.json" ]; then
            npm ci
          else
            echo '{"name": "screenshot-generator", "version": "1.0.0", "dependencies": {"puppeteer": "^21.0.0"}}' > package.json
            npm install
          fi
        env:
          PUPPETEER_SKIP_DOWNLOAD: true

      - name: Create screenshot script if not exists
        run: |
          if [ ! -f "screenshot.js" ] && [ ! -f "scripts/screenshot.js" ]; then
            mkdir -p scripts
            cat > scripts/screenshot.js << 'EOF'
          const puppeteer = require('puppeteer');
          const fs = require('fs');
          const path = require('path');

          async function takeScreenshot() {
            const browser = await puppeteer.launch({
              args: ['--no-sandbox', '--disable-setuid-sandbox', '--disable-dev-shm-usage'],
              executablePath: '/usr/bin/google-chrome'
            });
            
            const page = await browser.newPage();
            
            const githubPages = `https://${process.env.GITHUB_REPOSITORY_OWNER}.github.io/${process.env.GITHUB_REPOSITORY_NAME}/`;
            const indexPath = path.join(process.cwd(), 'index.html');
            
            let targetUrl;
            if (fs.existsSync(indexPath)) {
              targetUrl = `file://${indexPath}`;
            } else {
              targetUrl = githubPages;
              console.log(`üì° Using GitHub Pages URL: ${targetUrl}`);
            }
            
            try {
              await page.setViewport({
                width: parseInt(process.env.SCREENSHOT_WIDTH) || 1920,
                height: parseInt(process.env.SCREENSHOT_HEIGHT) || 1080
              });
              
              await page.goto(targetUrl, { waitUntil: 'networkidle2', timeout: 30000 });
              
              const selector = process.env.SCREENSHOT_SELECTOR || 'body';
              await page.waitForSelector(selector, { timeout: 10000 });
              
              await page.screenshot({
                path: 'screenshot.png',
                fullPage: true,
                type: 'png'
              });
              
              console.log('‚úÖ Screenshot created successfully');
            } catch (error) {
              console.error('‚ùå Screenshot failed:', error.message);
              
              const fallbackSvg = `
                <svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">
                  <rect width="800" height="600" fill="#f0f0f0"/>
                  <text x="400" y="300" text-anchor="middle" fill="#333" font-size="24" font-family="Arial">
                    Screenshot not available
                  </text>
                </svg>
              `;
              
              fs.writeFileSync('screenshot.svg', fallbackSvg);
              console.log('üìÑ Created SVG fallback');
            }
            
            await browser.close();
          }

          takeScreenshot().catch(console.error);
          EOF
          fi

      - name: Generate screenshot
        run: |
          if [ -f "package.json" ] && npm run | grep -q "screenshot"; then
            npm run screenshot
          else
            node scripts/screenshot.js
          fi
        env:
          GITHUB_REPOSITORY_OWNER: ${{ github.repository_owner }}
          GITHUB_REPOSITORY_NAME: ${{ github.event.repository.name }}
          SCREENSHOT_SELECTOR: ${{ github.event.inputs.screenshot_selector }}

      - name: Manage unique likes system
        run: |
          echo "üíñ Managing unique likes system..."

          # –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ —Ñ–∞–π–ª –ª–∞–π–∫—ñ–≤ —è–∫—â–æ –π–æ–≥–æ –Ω–µ–º–∞—î
          if [ ! -f "likes-data.json" ]; then
            cat > likes-data.json << 'EOF'
          {
            "total_likes": 0,
            "unique_users": [],
            "created_at": "",
            "last_updated": ""
          }
          EOF
            echo "üìù Created initial likes data file"
          fi

          # –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ—Ç–æ—á–Ω—ñ –¥–∞–Ω—ñ
          CURRENT_LIKES=$(jq -r '.total_likes' likes-data.json 2>/dev/null || echo "0")

          # –û—Ç—Ä–∏–º—É—î–º–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —è–∫–∏–π –∑–∞–ø—É—Å—Ç–∏–≤ workflow
          CURRENT_USER="${{ github.actor }}"
          TRIGGER_USER="${{ github.triggering_actor || github.actor }}"

          echo "üßë‚Äçüíª Current user: $CURRENT_USER"
          echo "üéØ Triggering user: $TRIGGER_USER"

          # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ö–æ—á–µ –¥–æ–¥–∞—Ç–∏ –ª–∞–π–∫
          if [ "${{ github.event.inputs.add_like }}" = "true" ]; then
            echo "üíñ User $TRIGGER_USER wants to add a like..."
            
            # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∂–µ –≥–æ–ª–æ—Å—É–≤–∞–≤
            USER_EXISTS=$(jq --arg user "$TRIGGER_USER" '.unique_users | contains([$user])' likes-data.json)
            
            if [ "$USER_EXISTS" = "true" ]; then
              echo "‚ö†Ô∏è User $TRIGGER_USER has already liked this repository!"
              echo "LIKE_STATUS=already_liked" >> $GITHUB_ENV
            else
              echo "‚úÖ Adding new like from user $TRIGGER_USER"
              
              # –î–æ–¥–∞—î–º–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –∑–±—ñ–ª—å—à—É—î–º–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫
              jq --arg user "$TRIGGER_USER" --arg date "$(date -u +%Y-%m-%dT%H:%M:%SZ)" \
                '.unique_users += [$user] | .total_likes += 1 | .last_updated = $date | if .created_at == "" then .created_at = $date else . end' \
                likes-data.json > likes-data.tmp && mv likes-data.tmp likes-data.json
              
              CURRENT_LIKES=$((CURRENT_LIKES + 1))
              echo "LIKE_STATUS=added" >> $GITHUB_ENV
              echo "üéâ Like added! Total: $CURRENT_LIKES"
            fi
          fi

          # –°—Ç–≤–æ—Ä—é—î–º–æ badge JSON
          cat > likes-count.json << EOF
          {
            "schemaVersion": 1,
            "label": "‚ù§Ô∏è unique likes",
            "message": "$CURRENT_LIKES",
            "color": "${{ env.LIKES_COLOR }}",
            "style": "${{ env.BADGE_STYLE }}"
          }
          EOF

          echo "üíñ Total unique likes: $CURRENT_LIKES"

      - name: Fetch unique repository traffic
        env:
          PAT_TOKEN: ${{ secrets.PAT_TOKEN }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "üîπ Fetching unique repository views for ${{ github.repository }}..."

          TOKEN="${PAT_TOKEN:-$GITHUB_TOKEN}"

          # –û—Ç—Ä–∏–º—É—î–º–æ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ –ø–µ—Ä–µ–≥–ª—è–¥–∏ (–Ω–µ –∑–∞–≥–∞–ª—å–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å)
          UNIQUE_VIEWS=$(curl -s -H "Authorization: token $TOKEN" \
            -H "Accept: application/vnd.github.v3+json" \
            "https://api.github.com/repos/${{ github.repository }}/traffic/views" \
            | jq '.uniques // 0')

          echo "üîç API Response for unique views: $UNIQUE_VIEWS"

          # Fallback —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –ø–µ—Ä–µ–≥–ª—è–¥—ñ–≤
          if [ "$UNIQUE_VIEWS" = "null" ] || [ -z "$UNIQUE_VIEWS" ] || [ "$UNIQUE_VIEWS" = "0" ]; then
            echo "‚ö†Ô∏è Could not fetch unique views from API, using fallback..."
            
            if [ ! -f "unique-visitors.json" ]; then
              cat > unique-visitors.json << 'EOF'
          {
            "unique_visitors": 1,
            "last_updated": "",
            "fallback_mode": true
          }
          EOF
              UNIQUE_VIEWS=1
            else
              CURRENT_UNIQUE=$(jq -r '.unique_visitors' unique-visitors.json 2>/dev/null || echo "1")
              
              # –Ü–Ω–∫—Ä–µ–º–µ–Ω—Ç—É—î–º–æ —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ workflow –∑–∞–ø—É—â–µ–Ω–æ –Ω–µ –±–æ—Ç–æ–º
              if [ "${{ github.actor }}" != "github-actions[bot]" ] && [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
                UNIQUE_VIEWS=$((CURRENT_UNIQUE + 1))
                echo "üë§ New unique visitor detected: $UNIQUE_VIEWS"
              else
                UNIQUE_VIEWS=$CURRENT_UNIQUE
              fi
              
              # –û–Ω–æ–≤–ª—é—î–º–æ —Ñ–∞–π–ª —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –≤—ñ–¥–≤—ñ–¥—É–≤–∞—á—ñ–≤
              jq --arg count "$UNIQUE_VIEWS" --arg date "$(date -u +%Y-%m-%dT%H:%M:%SZ)" \
                '.unique_visitors = ($count | tonumber) | .last_updated = $date' \
                unique-visitors.json > unique-visitors.tmp && mv unique-visitors.tmp unique-visitors.json
            fi
          fi

          echo "üü¢ Unique Repository Views: $UNIQUE_VIEWS"

          # –°—Ç–≤–æ—Ä—é—î–º–æ badge –¥–ª—è —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –ø–µ—Ä–µ–≥–ª—è–¥—ñ–≤
          cat > visitor-count.json << EOF
          {
            "schemaVersion": 1,
            "label": "üëÄ unique views",
            "message": "$UNIQUE_VIEWS",
            "color": "${{ env.BADGE_COLOR }}",
            "style": "${{ env.BADGE_STYLE }}"
          }
          EOF

      - name: Update or create README.md
        run: |
          REPO_URL="https://raw.githubusercontent.com/${{ github.repository }}/main"

          # –û—Ç—Ä–∏–º—É—î–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
          LIKES=$(jq -r '.total_likes' likes-data.json 2>/dev/null || echo "0")
          UNIQUE_VIEWS=$(jq -r '.message' visitor-count.json 2>/dev/null || echo "0")
          UNIQUE_USERS=$(jq -r '.unique_users | length' likes-data.json 2>/dev/null || echo "0")

          # –°—Ç–≤–æ—Ä—é—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Å—Ç–∞—Ç—É—Å –ª–∞–π–∫–∞
          LIKE_MESSAGE=""
          if [ "${{ env.LIKE_STATUS }}" = "added" ]; then
            LIKE_MESSAGE="‚úÖ **–î—è–∫—É—î–º–æ –∑–∞ –ª–∞–π–∫, ${{ github.triggering_actor }}!** üíñ"
          elif [ "${{ env.LIKE_STATUS }}" = "already_liked" ]; then
            LIKE_MESSAGE="‚ÑπÔ∏è **${{ github.triggering_actor }}**, –≤–∏ –≤–∂–µ –ø–æ—Å—Ç–∞–≤–∏–ª–∏ –ª–∞–π–∫ —Ü—å–æ–º—É –ø—Ä–æ–µ–∫—Ç—É! üíñ"
          fi

          # –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π README
          {
            echo "# ${{ github.event.repository.name }}"
            echo ""
            
            if [ -n "$LIKE_MESSAGE" ]; then
              echo "$LIKE_MESSAGE"
              echo ""
              echo "---"
              echo ""
            fi
            
            echo "<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ -->"
            echo "![Unique Views](https://img.shields.io/endpoint?url=${REPO_URL}/visitor-count.json)"
            echo "![Unique Likes](https://img.shields.io/endpoint?url=${REPO_URL}/likes-count.json)"
            echo "![GitHub Stars](https://img.shields.io/github/stars/${{ github.repository }}?style=${{ env.BADGE_STYLE }}&color=yellow)"
            echo ""
            echo "---"
            echo ""
            echo "## üíñ –ü–æ–¥–æ–±–∞—î—Ç—å—Å—è –ø—Ä–æ–µ–∫—Ç?"
            echo ""
            echo "**–ö–æ–∂–µ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ –ª–∏—à–µ –æ–¥–∏–Ω –ª–∞–π–∫!** ‚ù§Ô∏è"
            echo ""
            echo "### üéØ –Ø–∫ –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ —Å–≤—ñ–π —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π –ª–∞–π–∫:"
            echo ""
            echo "1. **–ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ [Actions](../../actions/workflows/$(basename ${{ github.workflow_ref }} .yml).yml)**"
            echo "2. **–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å \`Run workflow\`**" 
            echo "3. **–ü–æ—Å—Ç–∞–≤—Ç–µ –≥–∞–ª–æ—á–∫—É –±—ñ–ª—è \`Add your like\`**"
            echo "4. **–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å \`Run workflow\`**"
            echo ""
            echo "### üìä –ü–æ—Ç–æ—á–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:"
            echo "- üëÄ **–£–Ω—ñ–∫–∞–ª—å–Ω—ñ –ø–µ—Ä–µ–≥–ª—è–¥–∏**: ${UNIQUE_VIEWS}"
            echo "- üíñ **–£–Ω—ñ–∫–∞–ª—å–Ω—ñ –ª–∞–π–∫–∏**: ${LIKES} –≤—ñ–¥ ${UNIQUE_USERS} –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á(—ñ–≤)"
            echo "- ‚≠ê **GitHub Stars**: [–ü–æ—Å—Ç–∞–≤—Ç–µ –∑—ñ—Ä–æ—á–∫—É!](../../stargazers)"
            echo ""
            echo "> üí° **–ü—ñ–¥–∫–∞–∑–∫–∞**: –Ø–∫—â–æ –Ω–µ –º–æ–∂–µ—Ç–µ –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ –ª–∞–π–∫ —á–µ—Ä–µ–∑ Actions, –ø—Ä–æ—Å—Ç–æ –ø–æ—Å—Ç–∞–≤—Ç–µ ‚≠ê –∑—ñ—Ä–æ—á–∫—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é!"
            echo ""
            echo "## üì∏ Screenshot"
            echo ""
            
            if [ -f "screenshot.png" ]; then
              echo "![Screenshot](screenshot.png)"
            elif [ -f "screenshot.svg" ]; then
              echo "![Screenshot](screenshot.svg)"
            else
              echo "_Screenshot will be generated automatically_"
            fi
            
            echo ""
            
            # –î–æ–¥–∞—î–º–æ —Å–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —è–∫—ñ –ø–æ—Å—Ç–∞–≤–∏–ª–∏ –ª–∞–π–∫–∏ (—è–∫—â–æ —î)
            if [ "$LIKES" -gt "0" ]; then
              echo "## üíù –î—è–∫—É—î–º–æ –∑–∞ –ª–∞–π–∫–∏:"
              echo ""
              jq -r '.unique_users[]' likes-data.json | while read -r user; do
                echo "- [@${user}](https://github.com/${user}) ‚ù§Ô∏è"
              done
              echo ""
            fi
            
            # –î–æ–¥–∞—î–º–æ —ñ—Å–Ω—É—é—á–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç
            if [ -f "README_template.md" ]; then
              echo "---"
              echo ""
              cat README_template.md
            elif [ -f "README.md" ]; then
              # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ç—ñ–ª—å–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –ø—ñ—Å–ª—è —Ä–æ–∑–¥—ñ–ª—ñ–≤ –∑—ñ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ—é
              sed -n '/^## [^üì∏üíñüëÄüíùüìä]/,$p' README.md 2>/dev/null || echo ""
            else
              echo "## ‚ú® Features"
              echo ""
              echo "- üì∏ Automatic screenshot generation"
              echo "- üëÄ **Unique** visitor counter"  
              echo "- üíñ **One like per user** system"
              echo "- ü§ñ Updated via GitHub Actions"
              echo ""
              echo "## üöÄ About This System"
              echo ""
              echo "This repository uses an advanced workflow that tracks:"
              echo "- **Unique views** (not total page loads)"
              echo "- **Unique likes** (one per GitHub user)"
              echo "- **Real-time updates** through GitHub Actions"
              echo ""
              echo "_Last updated: $(date '+%Y-%m-%d %H:%M:%S UTC')_"
            fi
          } > README_new.md

          mv README_new.md README.md

      - name: Create likes interaction guide
        run: |
          cat > LIKES-GUIDE.md << 'EOF'
          # üíñ –£–Ω—ñ–∫–∞–ª—å–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ª–∞–π–∫—ñ–≤

          ## ‚ö° –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

          1. **[–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å —Ç—É—Ç –¥–ª—è –ª–∞–π–∫–∞](../../actions/workflows/screenshot-update.yml)** 
          2. **Run workflow** ‚Üí –ø–æ—Å—Ç–∞–≤—Ç–µ –≥–∞–ª–æ—á–∫—É **Add your like** ‚Üí **Run workflow**
          3. **–ì–æ—Ç–æ–≤–æ!** –í–∞—à –ª–∞–π–∫ –¥–æ–¥–∞–Ω–æ –¥–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ üìä

          ## üõ°Ô∏è –£–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å —Å–∏—Å—Ç–µ–º–∏

          ### üë§ –û–¥–∏–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á = –æ–¥–∏–Ω –ª–∞–π–∫
          - –ö–æ–∂–µ–Ω GitHub –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ **–ª–∏—à–µ –æ–¥–∏–Ω –ª–∞–π–∫**
          - –°–∏—Å—Ç–µ–º–∞ –∑–∞–ø–∞–º'—è—Ç–æ–≤—É—î –≤—Å—ñ—Ö, —Ö—Ç–æ –≤–∂–µ –≥–æ–ª–æ—Å—É–≤–∞–≤
          - –ü–æ–≤—Ç–æ—Ä–Ω—ñ –ª–∞–π–∫–∏ –≤—ñ–¥ —Ç–æ–≥–æ –∂ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ **–±–ª–æ–∫—É—é—Ç—å—Å—è**

          ### üëÄ –õ–∏—à–µ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ –ø–µ—Ä–µ–≥–ª—è–¥–∏  
          - –õ—ñ—á–∏–ª—å–Ω–∏–∫ –ø–æ–∫–∞–∑—É—î **—É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –≤—ñ–¥–≤—ñ–¥—É–≤–∞—á—ñ–≤**, –Ω–µ –∑–∞–≥–∞–ª—å–Ω—ñ –ø–µ—Ä–µ–≥–ª—è–¥–∏
          - –î–∞–Ω—ñ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è —á–µ—Ä–µ–∑ GitHub API traffic statistics
          - –§—ñ–ª—å—Ç—Ä—É—é—Ç—å—Å—è –±–æ—Ç–∏ —Ç–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ñ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–Ω—è

          ## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ

          –í—Å—ñ –¥–∞–Ω—ñ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ:
          - **–ö–æ–∂–Ω—ñ 2 –≥–æ–¥–∏–Ω–∏** (scheduled)
          - **–ü—Ä–∏ push** –Ω–æ–≤–æ–≥–æ –∫–æ–¥—É
          - **–ü—Ä–∏ —Ä—É—á–Ω–æ–º—É –∑–∞–ø—É—Å–∫—É** workflow

          ## üîí –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

          ### –§–∞–π–ª–∏ —Å–∏—Å—Ç–µ–º–∏:
          - `likes-data.json` - –±–∞–∑–∞ –¥–∞–Ω–∏—Ö –ª–∞–π–∫—ñ–≤ —Ç–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
          - `unique-visitors.json` - fallback –¥–ª—è —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –≤—ñ–¥–≤—ñ–¥—É–≤–∞—á—ñ–≤  
          - `likes-count.json` - badge –¥–ª—è –ª–∞–π–∫—ñ–≤
          - `visitor-count.json` - badge –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—ñ–≤

          ### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö –ª–∞–π–∫—ñ–≤:
          ```json
          {
            "total_likes": 5,
            "unique_users": ["user1", "user2", "user3"],
            "created_at": "2024-01-01T00:00:00Z",
            "last_updated": "2024-01-01T12:00:00Z"
          }
          ```

          ## üéØ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏

          –ù–µ –º–æ–∂–µ—Ç–µ –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ –ª–∞–π–∫ —á–µ—Ä–µ–∑ Actions? –°–ø—Ä–æ–±—É–π—Ç–µ:

          1. **‚≠ê GitHub Star** - –Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π —Å–ø–æ—Å—ñ–±
          2. **üç¥ Fork** —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é
          3. **üë• Follow** –∞–≤—Ç–æ—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É
          4. **üí¨ Issue** –∑ —Ç–µ–∫—Å—Ç–æ–º "üëç Like!"

          ## üö® –ß–∞—Å—Ç—ñ –ø–∏—Ç–∞–Ω–Ω—è

          **Q: –ß–æ–º—É —è –Ω–µ –º–æ–∂—É –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ –ª–∞–π–∫ –ø–æ–≤—Ç–æ—Ä–Ω–æ?**  
          A: –°–∏—Å—Ç–µ–º–∞ –¥–æ–∑–≤–æ–ª—è—î –ª–∏—à–µ –æ–¥–∏–Ω –ª–∞–π–∫ –Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–ª—è —á–µ—Å–Ω–æ—Å—Ç—ñ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.

          **Q: –ß–æ–º—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–µ—Ä–µ–≥–ª—è–¥—ñ–≤ –º–µ–Ω—à–∞ –Ω—ñ–∂ –æ—á—ñ–∫—É–≤–∞–≤?**  
          A: –ü–æ–∫–∞–∑—É—é—Ç—å—Å—è –ª–∏—à–µ **—É–Ω—ñ–∫–∞–ª—å–Ω—ñ** –≤—ñ–¥–≤—ñ–¥—É–≤–∞—á—ñ, –Ω–µ –∑–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–µ—Ä–µ–≥–ª—è–¥—ñ–≤.

          **Q: –Ø–∫ —Å–∫–∏–Ω—É—Ç–∏ —Å–≤—ñ–π –ª–∞–π–∫?**  
          A: –ù–∞—Ä–∞–∑—ñ —Ü–µ –Ω–µ–º–æ–∂–ª–∏–≤–æ —á–µ—Ä–µ–∑ –¥–∏–∑–∞–π–Ω —Å–∏—Å—Ç–µ–º–∏. –õ–∞–π–∫–∏ –Ω–µ–∑–≤–æ—Ä–æ—Ç–Ω—ñ.

          ---

          üí° **–ü–æ—Ä–∞–¥–∏ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞–º**: –í–∏ –º–æ–∂–µ—Ç–µ –∞–¥–∞–ø—Ç—É–≤–∞—Ç–∏ —Ü—é —Å–∏—Å—Ç–µ–º—É –¥–ª—è —Å–≤–æ—ó—Ö –ø—Ä–æ–µ–∫—Ç—ñ–≤!
          EOF

      - name: Check for changes
        id: changes
        run: |
          git add -A
          if git diff --cached --quiet; then
            echo "changed=false" >> $GITHUB_OUTPUT
            echo "‚ÑπÔ∏è No changes detected"
          else
            echo "changed=true" >> $GITHUB_OUTPUT
            echo "‚úÖ Changes detected"
          fi

      - name: Commit and push changes
        if: steps.changes.outputs.changed == 'true'
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

          git pull --rebase --autostash origin ${{ github.ref_name }} || true

          git add README.md screenshot.png screenshot.svg visitor-count.json likes-count.json likes-data.json unique-visitors.json LIKES-GUIDE.md 2>/dev/null || true

          # –§–æ—Ä–º—É—î–º–æ commit message –∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ—é
          LIKES=$(jq -r '.total_likes' likes-data.json 2>/dev/null || echo "0")
          UNIQUE_VIEWS=$(jq -r '.message' visitor-count.json 2>/dev/null || echo "0")

          COMMIT_MSG="üìä Stats: ${UNIQUE_VIEWS} unique views, ${LIKES} unique likes"

          if [ "${{ env.LIKE_STATUS }}" = "added" ]; then
            COMMIT_MSG="üíñ New like from ${{ github.triggering_actor }}! Total: ${LIKES}"
          elif [ "${{ env.LIKE_STATUS }}" = "already_liked" ]; then
            COMMIT_MSG="‚ö†Ô∏è ${{ github.triggering_actor }} already liked (${LIKES} total)"
          fi

          git commit -m "$COMMIT_MSG [ci skip]" || {
            echo "‚ö†Ô∏è No changes to commit"
            exit 0
          }

          git push origin ${{ github.ref_name }}

      - name: Display results
        if: always()
        run: |
          echo "üìä Workflow Summary:"
          echo "=================="

          if [ -f "likes-data.json" ]; then
            LIKES=$(jq -r '.total_likes' likes-data.json)
            UNIQUE_USERS=$(jq -r '.unique_users | length' likes-data.json)
            echo "üíñ Total Unique Likes: $LIKES from $UNIQUE_USERS users"
            
            if [ "$UNIQUE_USERS" -gt "0" ]; then
              echo "üë• Users who liked:"
              jq -r '.unique_users[]' likes-data.json | sed 's/^/   - @/'
            fi
          fi

          if [ -f "visitor-count.json" ]; then
            VIEWS=$(jq -r '.message' visitor-count.json)
            echo "üëÄ Total Unique Views: $VIEWS"
          fi

          if [ -f "screenshot.png" ]; then
            echo "üì∏ Screenshot: $(ls -lh screenshot.png | awk '{print $5}')"
          elif [ -f "screenshot.svg" ]; then
            echo "üìÑ Screenshot: SVG fallback created"
          fi

          # –°—Ç–∞—Ç—É—Å –ª–∞–π–∫–∞
          if [ "${{ env.LIKE_STATUS }}" = "added" ]; then
            echo "‚úÖ Like Status: NEW LIKE from ${{ github.triggering_actor }}"
          elif [ "${{ env.LIKE_STATUS }}" = "already_liked" ]; then
            echo "‚ö†Ô∏è Like Status: ${{ github.triggering_actor }} already liked"
          else
            echo "‚ÑπÔ∏è Like Status: No like action requested"
          fi

          echo "üåø Branch: ${{ github.ref_name }}"
          echo "üìù Repository: ${{ github.repository }}"
          echo "üßë‚Äçüíª Triggered by: ${{ github.triggering_actor || github.actor }}"
          echo "üïí Updated: $(date '+%Y-%m-%d %H:%M:%S UTC')"
